{"version":3,"sources":["../src/settings.js"],"names":[],"mappings":"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","file":"settings.js","sourcesContent":["const path = require('path');\n\nconst workingPath = path.dirname(require.main.filename);\nconst ROOT = process.env.ARTEFACT_PATH || workingPath;\nconst ENVIRONMENT = determineEnvironment();\nconst VERBOSE = process.env.VERBOSE === \"true\";\n\nconst log = VERBOSE ? console.log.bind(console) : function () {};\n\nlog(\"Determined running in: \" + ENVIRONMENT);\nlog(\"Root project path set as \" + ROOT);\n\n/*\n * To be valid packageJson,json must at the very least have\n * a name and a cloudformation field.\n */\nlog(\"Reading configuration from \" + ROOT + \"/package.json\");\nconst packageJson = require(ROOT + \"/package.json\");\n\nlet SETTINGS = {\n    verbose: VERBOSE,\n    rootDir: ROOT,\n    artefactsFilename: \"artifacts.zip\",\n    packageName: packageJson.name,\n    cloudformation: packageJson.cloudformation || \"cloudformation.json\",\n    buildStartTime: getDate(),\n    projectBranchName: getBranchName() || \"Unknown\",\n    manifestFile: \"build.json\",\n    vcsURL: packageJson.repository || \"Unknown\",\n    vcsRevision: getVcsRevision() || \"Unknown\",\n    buildId:  getBuildId() || \"DEV\",\n    artefactBucket: \"riffraff-artifact\",\n    manifestBucket: \"riffraff-builds\",\n    targetDir: ROOT + \"/target\",\n    leadDir: ROOT + \"/target/riffraff\",\n    packageDir: ROOT + \"/target/riffraff/packages/\" + packageJson.name,\n    buildDir: packageJson.buildDir || undefined,\n    env: ENVIRONMENT\n};\n\n\nfunction getDate() {\n    var date = new Date();\n    return date.toISOString();\n}\n\nfunction determineEnvironment() {\n    if (process.env.CIRCLECI && process.env.CI) {\n        return \"circle-ci\";\n    } else if (process.env.TRAVIS && process.env.CI) {\n        return \"travis-ci\";\n    } else {\n        return \"dev\";\n    }\n}\n\nfunction getBranchName() {\n    switch (ENVIRONMENT) {\n        case 'circle-ci':\n        return process.env.CIRCLE_BRANCH;\n\n        case 'travis-ci':\n        return process.env.TRAVIS_PULL_REQUEST === 'false' ? process.env.TRAVIS_BRANCH : process.env.TRAVIS_PULL_REQUEST;\n\n        default:\n        return \"dev\";\n    }\n}\n\nfunction getVcsRevision() {\n    switch (ENVIRONMENT) {\n        case 'circle-ci':\n        return process.env.CIRCLE_SHA1;\n\n        case 'travis-ci':\n        return process.env.TRAVIS_COMMIT;\n\n        default:\n        return \"dev\";\n    }\n}\n\nfunction getBuildId() {\n    switch (ENVIRONMENT) {\n        case 'circle-ci':\n        return process.env.CIRCLE_BUILD_NUM;\n\n        case 'travis-ci':\n        return process.env.TRAVIS_BUILD_NUMBER;\n\n        default:\n        return \"dev\";\n    }\n}\n\n// build tool specific settings - currently only works for CIRCL_CI\nlog(SETTINGS);\nexports.SETTINGS = SETTINGS;\n"]}